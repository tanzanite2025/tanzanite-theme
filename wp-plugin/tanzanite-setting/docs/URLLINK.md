# URLLink - URL ç®¡ç†ä¸é‡å†™

**åŠŸèƒ½æ¨¡å—**: URLLink  
**æƒé™è¦æ±‚**: `manage_options`  
**é›†æˆæ–¹å¼**: å·²é›†æˆåˆ° Tanzanite Settings

---

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

URLLink æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ URL ç®¡ç†å·¥å…·ï¼Œå…è®¸ä½ è‡ªå®šä¹‰æ–‡ç« ã€é¡µé¢å’Œå•†å“çš„ URL ç»“æ„ï¼Œåˆ›å»º URL ç›®å½•æ ‘ï¼Œç®¡ç† URL é‡å®šå‘ï¼Œå¹¶æ”¯æŒæ‰¹é‡æ“ä½œã€‚

---

## âœ¨ æ ¸å¿ƒåŠŸèƒ½

### 1. URL ç›®å½•ç®¡ç†

#### ç›®å½•æ ‘ç»“æ„

**åŠŸèƒ½**:
- åˆ›å»ºå±‚çº§ç›®å½•ç»“æ„
- ä¸ºæ¯ä¸ªç›®å½•è®¾ç½®è·¯å¾„åˆ«åï¼ˆpath_slugï¼‰
- å°†å†…å®¹é™„åŠ åˆ°ç›®å½•
- ç›®å½•é‡å‘½åå’Œåˆ é™¤

**ä½¿ç”¨åœºæ™¯**:
```
products/          # å•†å“ç›®å½•
  â”œâ”€â”€ phones/      # æ‰‹æœºå­ç›®å½•
  â”œâ”€â”€ laptops/     # ç¬”è®°æœ¬å­ç›®å½•
  â””â”€â”€ accessories/ # é…ä»¶å­ç›®å½•

guides/            # æŒ‡å—ç›®å½•
  â”œâ”€â”€ en/          # è‹±æ–‡æŒ‡å—
  â””â”€â”€ zh/          # ä¸­æ–‡æŒ‡å—
```

---

#### åˆ›å»ºç›®å½•

**æ­¥éª¤**:
1. åœ¨å·¦ä¾§"URL ç›®å½•æ ‘"é¢æ¿
2. å¡«å†™ç›®å½•åç§°ï¼ˆä¾‹å¦‚ï¼šå•†å“ï¼‰
3. å¡«å†™è·¯å¾„åˆ«åï¼ˆä¾‹å¦‚ï¼šproductsï¼‰
4. é€‰æ‹©çˆ¶ç›®å½•ï¼ˆå¯é€‰ï¼Œé»˜è®¤é¡¶å±‚ï¼‰
5. ç‚¹å‡»"æ–°å»ºç›®å½•"

**è·¯å¾„åˆ«åè§„åˆ™**:
- ä½¿ç”¨å°å†™å­—æ¯å’Œè¿å­—ç¬¦
- æ”¯æŒå¤šçº§è·¯å¾„ï¼ˆä¾‹å¦‚ï¼šguides/frï¼‰
- ä¸è¦ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦
- é¿å…ä¸ WordPress ä¿ç•™è·¯å¾„å†²çª

---

#### é™„åŠ å†…å®¹åˆ°ç›®å½•

**æ–¹æ³• 1ï¼šåœ¨ç›®å½•æ ‘ä¸­é™„åŠ **
1. æ‰¾åˆ°ç›®æ ‡ç›®å½•
2. åœ¨"å°†é¡µé¢é™„åŠ åˆ°è¯¥ç›®å½•"è¾“å…¥æ¡†ä¸­ç²˜è´´é¡µé¢ URL
3. ç‚¹å‡»"ç¡®å®šå¹¶åŒæ­¥"

**æ–¹æ³• 2ï¼šåœ¨å†…å®¹åˆ—è¡¨ä¸­è®¾ç½®**
1. åœ¨å³ä¾§å†…å®¹åˆ—è¡¨æ‰¾åˆ°ç›®æ ‡å†…å®¹
2. åœ¨"Custom Path"åˆ—å¡«å†™å®Œæ•´è·¯å¾„
3. ç‚¹å‡»"Save"

**ç¤ºä¾‹**:
```
ç›®å½•: products (path_slug: products)
å†…å®¹: iPhone 15 Pro (post_name: iphone-15-pro)
ç»“æœ URL: /products/iphone-15-pro
```

---

### 2. è‡ªå®šä¹‰ URL è·¯å¾„

#### å•ä¸ªå†…å®¹è®¾ç½®

**Custom Path å­—æ®µ**:
- å®Œæ•´è‡ªå®šä¹‰è·¯å¾„
- æ”¯æŒå˜é‡æ›¿æ¢
- è‡ªåŠ¨ä¿å­˜æ—§è·¯å¾„ç”¨äºé‡å®šå‘

**å˜é‡æ”¯æŒ**:
```
{postname}  - æ–‡ç« åˆ«å
{sku}       - å•†å“ SKUï¼ˆéœ€å¯ç”¨ï¼‰
{id}        - æ–‡ç«  ID
{year}      - å‘å¸ƒå¹´ä»½
{month}     - å‘å¸ƒæœˆä»½
{day}       - å‘å¸ƒæ—¥æœŸ
```

**ç¤ºä¾‹**:
```
åŸå§‹ URL: /iphone-15-pro/
è‡ªå®šä¹‰ URL: /products/phones/iphone-15-pro/
æ¨¡æ¿: products/phones/{postname}
```

---

#### æ‰¹é‡è®¾ç½®

**æ‰¹é‡åº”ç”¨åˆ°ç›®å½•**:
1. å‹¾é€‰è¦æ“ä½œçš„å†…å®¹
2. é€‰æ‹©ç›®æ ‡ç›®å½•
3. é€‰æ‹©ç­–ç•¥ï¼š
   - **replace**: å®Œå…¨æ›¿æ¢è·¯å¾„
   - **prefix**: æ·»åŠ å‰ç¼€
4. å¡«å†™æ—§å‰ç¼€ï¼ˆå¯é€‰ï¼Œç”¨äºæ›¿æ¢ï¼‰
5. å‹¾é€‰"å¹²è·‘é¢„è§ˆ"æŸ¥çœ‹æ•ˆæœ
6. ç‚¹å‡»"æ‰§è¡Œ"

**ç­–ç•¥è¯´æ˜**:

**Replace ç­–ç•¥**:
```
ç›®å½•: products/phones
å†…å®¹: iphone-15-pro
ç»“æœ: products/phones/iphone-15-pro
```

**Prefix ç­–ç•¥**:
```
ç›®å½•: products
æ—§å‰ç¼€: shop
åŸè·¯å¾„: shop/iphone-15-pro
ç»“æœ: products/iphone-15-pro
```

---

### 3. é¢å¤–é‡å®šå‘

#### Extra Redirects å­—æ®µ

**åŠŸèƒ½**:
- ä¸ºåŒä¸€å†…å®¹è®¾ç½®å¤šä¸ªæ—§ URL
- è‡ªåŠ¨ 301 é‡å®šå‘åˆ°å½“å‰ URL
- æ¯è¡Œä¸€ä¸ª URL

**ä½¿ç”¨åœºæ™¯**:
```
å½“å‰ URL: /products/iphone-15-pro/

é¢å¤–é‡å®šå‘:
/old-shop/iphone-15/
/phones/iphone15pro/
/mobile/apple-iphone-15-pro/
```

**æ•ˆæœ**:
- è®¿é—®ä»»ä½•æ—§ URL éƒ½ä¼šè‡ªåŠ¨é‡å®šå‘åˆ°å½“å‰ URL
- SEO å‹å¥½çš„ 301 æ°¸ä¹…é‡å®šå‘
- ä¿ç•™æœç´¢å¼•æ“æƒé‡

---

### 4. æ‰¹é‡æ“ä½œ

#### å¯ç”¨æ“ä½œ

**åˆ·æ–°åˆ—è¡¨**
- é‡æ–°åŠ è½½å†…å®¹åˆ—è¡¨
- æ›´æ–°æ˜¾ç¤ºçŠ¶æ€

**å¤åˆ¶å†…å®¹**
- å¤åˆ¶é€‰ä¸­çš„å†…å®¹
- åŒ…å«æ‰€æœ‰ meta æ•°æ®
- è‡ªåŠ¨æ ‡è®°ä¸ºå…‹éš†
- ç”Ÿæˆå”¯ä¸€çš„ URL

**ç§»è‡³å›æ”¶ç«™**
- å°†é€‰ä¸­å†…å®¹ç§»è‡³å›æ”¶ç«™
- å¯æ¢å¤

**å½»åº•åˆ é™¤**
- æ°¸ä¹…åˆ é™¤é€‰ä¸­å†…å®¹
- âš ï¸ ä¸å¯æ¢å¤

**åŒæ­¥åˆ° WordPress**
- é‡å»º URL æ˜ å°„
- åˆ·æ–°ç«™ç‚¹åœ°å›¾
- é€šçŸ¥ MyTheme SEO æ›´æ–°

---

### 5. URL æ˜ å°„ç®¡ç†

#### æ˜ å°„æœºåˆ¶

**è‡ªåŠ¨æ˜ å°„**:
- æ¯æ¬¡ä¿å­˜è‡ªå®šä¹‰è·¯å¾„æ—¶è‡ªåŠ¨æ›´æ–°
- å­˜å‚¨åœ¨ `urllink_path_map` option
- å¿«é€ŸæŸ¥æ‰¾å’Œé‡å®šå‘

**æ‰‹åŠ¨é‡å»º**:
- ç‚¹å‡»"é‡å»ºæ˜ å°„"æŒ‰é’®
- æ‰«ææ‰€æœ‰å†…å®¹çš„è‡ªå®šä¹‰è·¯å¾„
- é‡æ–°ç”Ÿæˆå®Œæ•´æ˜ å°„è¡¨

---

## ğŸ”§ é«˜çº§åŠŸèƒ½

### 1. SKU åœ¨ URL ä¸­

**å¯ç”¨è®¾ç½®**:
```php
// åœ¨ WordPress è®¾ç½®ä¸­å¯ç”¨
update_option('urllink_enable_sku_in_url', 1);
```

**ä½¿ç”¨ SKU å˜é‡**:
```
æ¨¡æ¿: products/{sku}-{postname}
SKU: IP15P-256-BLK
ç»“æœ: products/IP15P-256-BLK-iphone-15-pro
```

---

### 2. æ—§è·¯å¾„è‡ªåŠ¨ä¿å­˜

**æœºåˆ¶**:
- ä¿®æ”¹ Custom Path æ—¶è‡ªåŠ¨ä¿å­˜æ—§è·¯å¾„
- å­˜å‚¨åœ¨ `_urllink_old_paths` meta
- è‡ªåŠ¨è®¾ç½® 301 é‡å®šå‘

**æŸ¥çœ‹æ—§è·¯å¾„**:
```php
$old_paths = get_post_meta($post_id, '_urllink_old_paths', true);
// è¿”å›æ•°ç»„ï¼š['old-path-1', 'old-path-2']
```

---

### 3. å…‹éš†å†…å®¹

**å…‹éš†æ ‡è®°**:
- å…‹éš†çš„å†…å®¹è‡ªåŠ¨æ ‡è®°
- æ˜¾ç¤º"CLONED"å¾½ç« 
- è®°å½•åŸå§‹å†…å®¹ ID

**Meta å­—æ®µ**:
```php
_urllink_cloned: 1
_urllink_cloned_from: åŸå§‹å†…å®¹ID
```

---

## ğŸ’» å¼€å‘è€…æ¥å£

### é’©å­å’Œè¿‡æ»¤å™¨

#### é‡å»ºæ˜ å°„å
```php
add_action('urllink_maps_rebuilt', function() {
    // æ˜ å°„é‡å»ºå®Œæˆ
});
```

#### ä¸ MyTheme SEO é›†æˆ
```php
// URLLink è¯·æ±‚åˆ·æ–°ç«™ç‚¹åœ°å›¾
do_action('mytheme_seo_request_sitemap_rebuild', [
    'source' => 'urllink'
]);

// URLLink è¯·æ±‚åˆ·æ–°
do_action('mytheme_seo_refresh_after_urllink');
```

---

### å‡½æ•°

#### è§„èŒƒåŒ–è·¯å¾„
```php
function urllink_normalize_path($path) {
    return trim($path, '/');
}
```

#### æ›´æ–°æ˜ å°„
```php
function urllink_update_map_for_post($post_id, $path) {
    $map = get_option('urllink_path_map', []);
    $norm = urllink_normalize_path($path);
    $map[$norm] = $post_id;
    update_option('urllink_path_map', $map);
}
```

#### é‡å»ºæ‰€æœ‰æ˜ å°„
```php
URLLink_Plugin::rebuild_maps();
```

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### 1. å¤šè¯­è¨€ç½‘ç«™

**ç›®å½•ç»“æ„**:
```
/en/products/iphone-15-pro/
/zh/products/iphone-15-pro/
/fr/products/iphone-15-pro/
```

**è®¾ç½®**:
1. åˆ›å»ºè¯­è¨€ç›®å½•ï¼šen, zh, fr
2. å°†å†…å®¹é™„åŠ åˆ°å¯¹åº”è¯­è¨€ç›®å½•
3. ä½¿ç”¨ {postname} ä¿æŒä¸€è‡´æ€§

---

### 2. å•†å“åˆ†ç±»

**ç›®å½•ç»“æ„**:
```
/products/phones/
/products/laptops/
/products/accessories/
```

**æ‰¹é‡æ“ä½œ**:
1. åˆ›å»ºåˆ†ç±»ç›®å½•
2. æ‰¹é‡é€‰æ‹©å•†å“
3. åº”ç”¨åˆ°å¯¹åº”ç›®å½•

---

### 3. SEO ä¼˜åŒ–

**URL é‡æ„**:
```
æ—§ URL: /p=123
æ–° URL: /products/category/product-name/

æ—§ URL: /product/12345/
æ–° URL: /shop/product-name/
```

**ä¿ç•™ SEO**:
- æ—§ URL è‡ªåŠ¨ 301 é‡å®šå‘
- æœç´¢å¼•æ“æƒé‡ä¿ç•™
- ç”¨æˆ·ä½“éªŒä¸å—å½±å“

---

### 4. ç½‘ç«™è¿ç§»

**ä»å…¶ä»–å¹³å°è¿ç§»**:
1. å¯¼å…¥å†…å®¹åˆ° WordPress
2. åœ¨ Extra Redirects æ·»åŠ æ—§ URL
3. ä¿æŒæ—§é“¾æ¥å¯è®¿é—®
4. é€æ­¥æ›´æ–°å¤–éƒ¨é“¾æ¥

---

## ğŸ“ æœ€ä½³å®è·µ

### 1. URL è®¾è®¡åŸåˆ™

**ç®€æ´æ˜äº†**:
```
âœ… /products/iphone-15-pro/
âŒ /category/products/subcategory/phones/apple/iphone-15-pro-256gb-black/
```

**ä½¿ç”¨è¿å­—ç¬¦**:
```
âœ… /iphone-15-pro/
âŒ /iphone_15_pro/
âŒ /iPhone15Pro/
```

**é¿å…ç‰¹æ®Šå­—ç¬¦**:
```
âœ… /products/phone/
âŒ /äº§å“/æ‰‹æœº/
âŒ /products/phone%20case/
```

---

### 2. ç›®å½•è§„åˆ’

**å±‚çº§ä¸è¦å¤ªæ·±**:
```
âœ… /products/phones/iphone-15-pro/
âŒ /shop/products/electronics/phones/smartphones/apple/iphone/15/pro/
```

**ä½¿ç”¨æœ‰æ„ä¹‰çš„åç§°**:
```
âœ… /products/
âœ… /guides/
âœ… /support/

âŒ /cat1/
âŒ /section-a/
âŒ /misc/
```

---

### 3. é‡å®šå‘ç®¡ç†

**å®šæœŸæ¸…ç†**:
- æ£€æŸ¥ä¸å†éœ€è¦çš„é‡å®šå‘
- åˆ é™¤è¿‡æœŸçš„æ—§ URL
- ä¿æŒæ˜ å°„è¡¨ç²¾ç®€

**æµ‹è¯•é‡å®šå‘**:
- è®¿é—®æ—§ URL ç¡®è®¤è·³è½¬
- æ£€æŸ¥ HTTP çŠ¶æ€ç ï¼ˆåº”ä¸º 301ï¼‰
- éªŒè¯ç›®æ ‡ URL æ­£ç¡®

---

### 4. æ€§èƒ½ä¼˜åŒ–

**æ˜ å°„è¡¨ä¼˜åŒ–**:
- å®šæœŸé‡å»ºæ˜ å°„
- æ¸…ç†æ— æ•ˆæ¡ç›®
- ä½¿ç”¨å¯¹è±¡ç¼“å­˜

**æ‰¹é‡æ“ä½œ**:
- å¤§é‡å†…å®¹æ—¶åˆ†æ‰¹å¤„ç†
- ä½¿ç”¨å¹²è·‘é¢„è§ˆéªŒè¯
- å®Œæˆåé‡å»ºæ˜ å°„

---

## ğŸ” æ•…éšœæ’é™¤

### Q: è‡ªå®šä¹‰ URL ä¸ç”Ÿæ•ˆï¼Ÿ

**A**: æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š
1. æ˜¯å¦ç‚¹å‡»äº†"Save"æŒ‰é’®
2. æ˜¯å¦é‡å»ºäº†æ˜ å°„
3. æ˜¯å¦åˆ·æ–°äº†å›ºå®šé“¾æ¥ï¼ˆè®¾ç½® â†’ å›ºå®šé“¾æ¥ â†’ ä¿å­˜ï¼‰
4. æ£€æŸ¥ .htaccess æ–‡ä»¶æƒé™

---

### Q: é‡å®šå‘ä¸å·¥ä½œï¼Ÿ

**A**: 
1. ç¡®è®¤æ—§è·¯å¾„å·²ä¿å­˜åˆ° Extra Redirects
2. é‡å»º URL æ˜ å°„
3. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜
4. æ£€æŸ¥æœåŠ¡å™¨é‡å†™è§„åˆ™

---

### Q: æ‰¹é‡æ“ä½œå¤±è´¥ï¼Ÿ

**A**:
1. æ£€æŸ¥æ˜¯å¦å‹¾é€‰äº†å†…å®¹
2. ç¡®è®¤ç›®å½• path_slug å·²è®¾ç½®
3. ä½¿ç”¨å¹²è·‘é¢„è§ˆæŸ¥çœ‹é”™è¯¯
4. åˆ†æ‰¹å¤„ç†å¤§é‡å†…å®¹

---

### Q: å…‹éš†å†…å®¹ URL å†²çªï¼Ÿ

**A**:
- å…‹éš†æ—¶è‡ªåŠ¨æ·»åŠ  `-copy` åç¼€
- å¦‚æœä»å†²çªï¼Œä¼šæ·»åŠ æ•°å­—åç¼€
- æ‰‹åŠ¨ä¿®æ”¹ Custom Path é¿å…å†²çª

---

## ğŸ—„ï¸ æ•°æ®åº“

### æ–‡ç«  Meta

| Meta Key | è¯´æ˜ | ç±»å‹ |
|----------|------|------|
| `_urllink_path` | è‡ªå®šä¹‰è·¯å¾„ | string |
| `_urllink_extra_redirects` | é¢å¤–é‡å®šå‘ | string (å¤šè¡Œ) |
| `_urllink_old_paths` | æ—§è·¯å¾„åˆ—è¡¨ | array |
| `_urllink_cloned` | æ˜¯å¦å…‹éš† | boolean |
| `_urllink_cloned_from` | å…‹éš†æº ID | integer |

### Term Meta

| Meta Key | è¯´æ˜ | ç±»å‹ |
|----------|------|------|
| `path_slug` | ç›®å½•è·¯å¾„åˆ«å | string |

### Options

| Option Key | è¯´æ˜ | ç±»å‹ |
|------------|------|------|
| `urllink_path_map` | URL æ˜ å°„è¡¨ | array |
| `urllink_enable_sku_in_url` | å¯ç”¨ SKU | boolean |

---

## ğŸ”— ç›¸å…³åŠŸèƒ½

- **MyTheme SEO**: è‡ªåŠ¨æ›´æ–°ç«™ç‚¹åœ°å›¾
- **Tanzanite Settings**: é›†æˆåˆ°ä¸»æ’ä»¶
- **WordPress å›ºå®šé“¾æ¥**: é…åˆä½¿ç”¨

---

## ğŸ“š å‚è€ƒèµ„æº

### WordPress å‡½æ•°
- `url_to_postid()` - URL è½¬æ–‡ç«  ID
- `get_permalink()` - è·å–å›ºå®šé“¾æ¥
- `wp_redirect()` - é‡å®šå‘
- `flush_rewrite_rules()` - åˆ·æ–°é‡å†™è§„åˆ™

### ç›¸å…³æ–‡æ¡£
- [WordPress å›ºå®šé“¾æ¥](https://wordpress.org/support/article/using-permalinks/)
- [301 é‡å®šå‘æœ€ä½³å®è·µ](https://moz.com/learn/seo/redirection)

---

**æœ€åæ›´æ–°**: 2025-11-11  
**ç»´æŠ¤è€…**: Tanzanite Team
